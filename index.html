<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>è‹±æ–‡å¿è€…æ‰“å­—éŠæˆ²</title>
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    html, body { width:100%; height:100%; margin:0; padding:0; }
    /* Splash æ”¹ç”¨ <img> */
    #splash-screen {
      position: fixed;
      top:0; left:0;
      width:100vw; height:100vh;
      background-color:#000;
      cursor:pointer;
      z-index:4000;
      display:flex; align-items:center; justify-content:center;
    }
    #splash-image {
      max-width:100%;
      max-height:100%;
      object-fit:contain;
    }
    /* åˆå§‹éš±è— */
    #game-container, #login-overlay, #virtual-keyboard {
      display: none;
    }
  </style>
</head>
<body>
  <div id="splash-screen">
    <img id="splash-image" src="./img/login.png" alt="ç™»å…¥ç•«é¢">
  </div>

<!-- Game Over å°ˆç”¨èƒŒæ™¯ -->
<div id="gameover-bg"
     style="
       display: none;
       position: fixed;
       top: 0; left: 0;
       width:100vw; height:100vh;
       background: url('./img/background5.png') no-repeat center center;
       background-size: cover;
       z-index: 3000;
     ">
</div>

  <!-- åŸæœ¬çš„ç™»å…¥é®ç½© -->
  <div id="login-overlay">
    <div class="login-box">
      <h2>è«‹è¼¸å…¥ç©å®¶ç·¨è™Ÿ</h2>
      <input
  id="player-id"
  type="text"
  placeholder="ä¾‹å¦‚ï¼š30101"
  maxlength="5"
  inputmode="numeric"
  pattern="[0-9]*"
  lang="en"
  autocapitalize="none"
  autocorrect="off"
  spellcheck="false"
/>

      <button id="login-btn">ç™»å…¥éŠæˆ²</button>
      <p id="login-error" style="color: red; margin-top: 8px;"></p>
    </div>
  </div>

  <!-- éŠæˆ²å®¹å™¨ -->
  <div id="game-container">
    <canvas id="game-canvas" tabindex="0"></canvas>
    <div id="ui">
      <!-- ä¿ç•™åŸæœ‰ UI çµæ§‹ -->
      <div id="health-label">ç©å®¶è¡€é‡</div>
<div id="health-bar" style="position: relative;">
  <div id="health-fill"></div>
  <div id="icon-health-wrap"
       style="position:absolute; top:0; left:100%; margin-left:8px; display:none; align-items:center;">
    <img src="img/health.png" width="32" height="32" />
    <span id="health-count" style="color:white; margin-left:4px;">0</span>
  </div>
</div>
      <div id="practice-timer">
  ç·´ç¿’å‰©é¤˜æ™‚é–“ï¼š30s
  <div id="icon-decoy-wrap"
       style="position:absolute; top:0; left:100%; margin-left:8px; display:none; align-items:center;">
    <img src="img/dodge.png" width="32" height="32" />
    <span id="decoy-count" style="color:white; margin-left:4px;">0</span>
  </div>
</div>
      <div id="score-center">åˆ†æ•¸ï¼š0</div>
      <div id="combo-display"></div>
      <div id="level-info">ç¬¬ 1 é—œï¼šSADï¼ˆé›£éï¼‰</div>
      <div id="instructions">
        30ç§’ç·´ç¿’æ“Šè½æ¨™é¶å¯ç´¯ç©åˆ†æ•¸ï¼Œæ“Šè½é ­ç›®æ‰‹è£¡åŠåæ“Šå¼±é»ï¼Œæ“Šé€€é ­ç›®å¯é€²å…¥ä¸‹ä¸€é—œã€‚
      </div>
    </div>

  <!-- é—œå¡éé—œ Overlay -->
  <div id="level-overlay" style="display:none;">
  <div class="overlay-box">
    <div id="level-text" class="overlay-title"></div>
    <button id="level-btn" class="overlay-btn" style="margin-bottom:16px;">ä¸‹ä¸€é—œ</button>
    <button id="ach-btn" class="overlay-btn" style="margin-bottom:8px;">ğŸ† æˆå°±ç´€éŒ„</button>
    <button id="vocab-btn" class="overlay-btn">ğŸ“– è©å½™åœ–é‘‘</button>
  </div>
</div>

  <!-- æš«åœé¸å–® Overlay -->
  <div id="pause-overlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.83);z-index:3500;align-items:center;justify-content:center;">
    <div style="background:#222;padding:40px 32px 24px 32px;border-radius:24px;min-width:220px;max-width:90vw;text-align:center;">
      <div style="font-size:2em;color:#ffea00;margin-bottom:24px;">éŠæˆ²æš«åœ</div>
      <button id="pause-vocab-btn" class="pause-btn" style="margin:12px 0;width:80%;font-size:1.2em;">ğŸ“– è©å½™åœ–é‘‘</button><br>
      <button id="pause-ach-btn" class="pause-btn" style="margin:12px 0;width:80%;font-size:1.2em;">ğŸ† æˆå°±ç´€éŒ„</button><br>
      <button id="pause-resume-btn" class="pause-btn" style="margin:22px 0 0 0;width:80%;font-size:1.2em;background:#ffea00;color:#222;">ç¹¼çºŒéŠæˆ²</button>

    </div>
  </div>

  <!-- è©å½™åœ–é‘‘ Overlay -->
  <div id="vocab-overlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:3000;justify-content:center;align-items:center;color:white;">
    <div style="max-width:900px;background:#222;padding:30px;border-radius:16px;max-height:80vh;overflow:auto;">
      <h2 style="text-align:center;">è©å½™åœ–é‘‘</h2>
      <ul id="vocab-ul" style="list-style:none;padding:0;"></ul>
      <button id="vocab-overlay-close-btn">é—œé–‰</button>
    </div>
  </div>

    <!-- è™›æ“¬éµç›¤ (ä¸‰æ’é…ç½®) -->
  <div id="virtual-keyboard">
    <div class="vk-row">
      <button class="vk-key" data-key="Q">Q</button>
      <button class="vk-key" data-key="W">W</button>
      <button class="vk-key" data-key="E">E</button>
      <button class="vk-key" data-key="R">R</button>
      <button class="vk-key" data-key="T">T</button>
      <button class="vk-key" data-key="Y">Y</button>
      <button class="vk-key" data-key="U">U</button>
      <button class="vk-key" data-key="I">I</button>
      <button class="vk-key" data-key="O">O</button>
      <button class="vk-key" data-key="P">P</button>
    </div>
    <div class="vk-row">
      <button class="vk-key" data-key="A">A</button>
      <button class="vk-key" data-key="S">S</button>
      <button class="vk-key" data-key="D">D</button>
      <button class="vk-key" data-key="F">F</button>
      <button class="vk-key" data-key="G">G</button>
      <button class="vk-key" data-key="H">H</button>
      <button class="vk-key" data-key="J">J</button>
      <button class="vk-key" data-key="K">K</button>
      <button class="vk-key" data-key="L">L</button>
    </div>
    <div class="vk-row">
      <button class="vk-key" data-key="Z">Z</button>
      <button class="vk-key" data-key="X">X</button>
      <button class="vk-key" data-key="C">C</button>
      <button class="vk-key" data-key="V">V</button>
      <button class="vk-key" data-key="B">B</button>
      <button class="vk-key" data-key="N">N</button>
      <button class="vk-key" data-key="M">M</button>
      <button class="vk-key pause" data-key="Pause">æš«åœ</button>
      <button class="vk-key end" data-key="End">çµæŸ</button>
    </div>
  </div>

  <!-- æ”¾åœ¨ </body> å‰ -->
<div id="ach-overlay" class="overlay">
  <div class="overlay-content">
    <button id="ach-close" class="close-btn">&times;</button>
    <h2>æˆå°±åˆ—è¡¨</h2>
    <div id="ach-grid" class="grid"></div>
  </div>
</div>

  <!-- æˆå°±è©³æƒ…å½ˆçª— -->
  <div id="ach-detail-modal" class="overlay">
    <div class="overlay-content">
      <button id="ach-detail-close" class="close-btn">&times;</button>
      <h2 id="ach-detail-title"></h2>
      <p id="ach-detail-desc" style="margin-top:12px; line-height:1.4;"></p>
    </div>
  </div>

<!-- æ’è¡Œæ¦œ Overlay -->
<div id="leaderboard-overlay"
     style="display:none;
            position:fixed;top:0;left:0;
            width:100vw;height:100vh;
            background:rgba(0,0,0,0.85);
            z-index:3600;
            justify-content:center;align-items:center;">
  <div style="background:#222;padding:30px;border-radius:16px;max-height:80vh;overflow:auto;color:#fff;">
    <h2 style="text-align:center;margin-bottom:16px;">æ’è¡Œæ¦œ</h2>
    <table style="width:100%;border-collapse:collapse;">
            <thead>
        <tr>
          <th style="padding:8px;border-bottom:1px solid #555;">æ’å</th>
          <th style="padding:8px;border-bottom:1px solid #555;">ç©å®¶ç·¨è™Ÿ</th>
          <th style="padding:8px;border-bottom:1px solid #555;">æœ€é«˜é—œå¡</th>
          <th style="padding:8px;border-bottom:1px solid #555;">æœ€é«˜åˆ†æ•¸</th>
          <th style="padding:8px;border-bottom:1px solid #555;">åœ–é‘‘æ•¸é‡</th>
          <th style="padding:8px;border-bottom:1px solid #555;">éŠ…/éŠ€/é‡‘æ•¸</th>
          <th style="padding:8px;border-bottom:1px solid #555;">ç¸½åˆ†</th>
        </tr>
      </thead>

      <tbody id="leaderboard-table-body">
        <!-- JS å‹•æ…‹æ’å…¥ -->
      </tbody>
    </table>
    <button id="leaderboard-close"
            style="margin-top:16px;padding:8px 16px;
                   background:#ffea00;color:#222;
                   border:none;border-radius:4px;
                   font-size:1em;display:block;margin:12px auto 0 auto;">
      é—œé–‰
    </button>
  </div>
</div>

  <!-- è‡ªè¨‚æˆå°±è§£é–é€šçŸ¥ Overlay -->
  <div id="ach-notify-overlay">
    <div id="ach-notify-box">
      <div id="ach-notify-text"></div>
      <button id="ach-notify-btn">ç¢ºå®š</button>
    </div>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {

    function isLoginVisible() {
      const ov = document.getElementById('login-overlay');
      if (!ov) return false;
      return window.getComputedStyle(ov).display !== 'none';
    }

    window.addEventListener('keydown', (e) => {
      // âœ… åªåœ¨ç™»å…¥ç•«é¢æ™‚æ‰å…è¨±å¿«æ·éµé€²å¾Œå°
      if (isLoginVisible()) {
        const key = e.key.toUpperCase();
        const isAdminHotkey = (e.ctrlKey || e.metaKey) && key === 'A'; // âœ… Mac æ”¯æ´ Cmd + A

        if (isAdminHotkey) {
          e.preventDefault();
          const pw = prompt('è«‹è¼¸å…¥å¾Œå°ç®¡ç†å¯†ç¢¼');
          if (pw !== '1070') {
            alert('å¯†ç¢¼éŒ¯èª¤');
            return;
          }
          window.location.href = './admin.html';
        }

        // âœ… å…¶ä»–éµç›¤äº‹ä»¶éƒ½ä¸æ””æˆªï¼Œè®“ input æ­£å¸¸è¼¸å…¥
        return;
      }

      // âœ… éç™»å…¥ç•«é¢ï¼šé€™è£¡ä¸åšä»»ä½•äº‹ï¼ˆéŠæˆ²éµç›¤äº¤çµ¦ input.jsï¼‰
    });
  });
</script>

<script type="module">
    import { startGame } from './js/main.js';

    const splash     = document.getElementById('splash-screen');
    const loginOv    = document.getElementById('login-overlay');
    const gameCont   = document.getElementById('game-container');
    const vkBoard    = document.getElementById('virtual-keyboard');
    const loginBtn   = document.getElementById('login-btn');
    const playerIdEl = document.getElementById('player-id');
    const errorEl    = document.getElementById('login-error');

    // 1. é»æ“Š Splash â†’ é¡¯ç¤ºç™»å…¥è¦–çª—
    splash.addEventListener('click', () => {
  splash.style.display   = 'none';
  loginOv.style.display  = 'flex';

  // âœ… è‡ªå‹•æŠŠæ¸¸æ¨™æ”¾åˆ°è¼¸å…¥æ¡†
  setTimeout(() => playerIdEl.focus(), 0);
});

  // å³æ™‚éæ¿¾ï¼šåªç•™æ•¸å­—ä¸¦ä¸”æœ€å¤š 5 ä½
  playerIdEl.addEventListener('input', () => {
    let v = playerIdEl.value.replace(/\D/g, '').slice(0, 5);
    if (playerIdEl.value !== v) playerIdEl.value = v;
  });

  loginBtn.addEventListener('click', () => {
    const id = playerIdEl.value.trim();
    // åƒ…æ¥å— **æ­£å¥½** 5 ä½æ•¸å­—
    if (!/^\d{5}$/.test(id)) {
      errorEl.textContent = 'è«‹è¼¸å…¥æ­£å¥½ 5 ä½æ•¸å­—ç·¨è™Ÿ';
      return;
    }
if (!window.gameState || !window.gameState.player) {
  errorEl.textContent = 'éŠæˆ²åˆå§‹åŒ–å°šæœªå®Œæˆï¼Œè«‹é‡æ–°æ•´ç†å¾Œå†è©¦ä¸€æ¬¡';
  return;
}
    // 1. è¨­å®šç©å®¶ç·¨è™Ÿ
    window.gameState.player.id = id;

    // 2. æ¸…ç©ºä¸Šä¸€ä½ç©å®¶çš„è©å½™åœ–é‘‘èˆ‡æˆå°±
    localStorage.setItem('unlockedWords', JSON.stringify([]));
    localStorage.setItem('achievementsUnlocked', JSON.stringify([]));
    window.gameState.unlockedWords       = [];
    window.gameState.achievementsUnlocked = [];

    // 3. éš±è—ç™»å…¥ã€é¡¯ç¤ºéŠæˆ²
    loginOv.style.display  = 'none';
    gameCont.style.display = 'block';
    vkBoard.style.display  = 'flex';

    // è®“ canvas æ­£ç¢ºèª¿æ•´å°ºå¯¸
    window.dispatchEvent(new Event('resize'));

    // 4. å•Ÿå‹•éŠæˆ²
    startGame();
  });
</script>
</body>
</html>